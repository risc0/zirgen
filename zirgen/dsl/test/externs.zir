// RUN: zirgen --emit=zstruct %s | FileCheck %s

component PairVal(aArg: Val, bArg: Val) {
   a := aArg;
   b := bArg;
}

extern TakesArg(x: Val);
extern ReturnsVal() : Val;
extern TakesPair(v: PairVal);
extern ReturnsPair() : PairVal;

component Top() {
  // CHECK: %0 = zll.extern "ReturnsVal" "", () : () -> !zll.val<BabyBear>
  // CHECK: zll.extern "TakesArg" "", (%0) : (!zll.val<BabyBear>) -> ()
  // CHECK: %1:2 = zll.extern "ReturnsPair" "", () : () -> (!zll.val<BabyBear>, !zll.val<BabyBear>)
  // CHECK: zll.extern "TakesPair" "", (%1#0, %1#1) : (!zll.val<BabyBear>, !zll.val<BabyBear>) -> ()
  TakesArg(ReturnsVal());
  TakesPair(ReturnsPair());
}

// RUN: zirgen --test %s 2>&1 | FileCheck %s --check-prefixes=TEST-CHECK

test val {
// TEST-CHECK-LABEL: Running val
// TEST-CHECK-NEXT: [0] ReturnsVal() -> (0)
// TEST-CHECK-NEXT: [0] TakesArg(0) -> ()
  TakesArg(ReturnsVal());
}

test pair {
// TEST-CHECK-LABEL: Running pair
// TEST-CHECK-NEXT: [0] ReturnsPair() -> (0, 1)
// TEST-CHECK-NEXT: [0] TakesPair(0, 1) -> ()
  TakesPair(ReturnsPair());
}
